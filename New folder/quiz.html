<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª - Ø¹Ù„ÙˆÙ… Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* Ø£Ù†Ù…Ø§Ø· Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª */
        .quiz-system {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }

        .quiz-info {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-card {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 120px;
        }

        .info-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-number {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.6;
            color: #2d3748;
            margin-bottom: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border-right: 4px solid #667eea;
        }

        .options-container {
            display: grid;
            gap: 12px;
            margin: 25px 0;
        }

        .option {
            padding: 18px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.1rem;
        }

        .option:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .option.selected {
            border-color: #667eea;
            background: #e6fffa;
            color: #234e52;
        }

        .option-letter {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #a0aec0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .option.selected .option-letter {
            background: #667eea;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        .btn-success {
            background: #38a169;
            color: white;
        }

        .btn-success:hover {
            background: #2f855a;
        }

        .btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            margin: 25px 0;
        }

        .progress-bar {
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: #4a5568;
            font-weight: 600;
        }

        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        .results-container {
            text-align: center;
            padding: 40px;
        }

        .result-score {
            font-size: 4rem;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .result-message {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #2d3748;
        }

        .result-details {
            background: #f7fafc;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: right;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .actions-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .alert-warning {
            background: #fff5eb;
            color: #744210;
            border-right: 4px solid #ed8936;
        }

        .alert-success {
            background: #f0fff4;
            color: #22543d;
            border-right: 4px solid #48bb78;
        }

        /* responsive */
        @media (max-width: 768px) {
            .quiz-info {
                flex-direction: column;
                align-items: center;
            }

            .info-card {
                width: 100%;
                max-width: 200px;
            }

            .navigation-buttons {
                flex-direction: column;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .actions-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="../images/dalty-logo.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="school-logo">
                    <img src="../images/ehab.jpg" alt="ØµÙˆØ±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¥ÙŠÙ‡Ø§Ø¨" class="teacher-photo">
                </div>
                <div class="header-text">
                    <h1 class="logo">ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h1>
                    <p class="subtitle">Discover with Dalty - ØªÙ‚ÙŠÙŠÙ… ØªÙØ§Ø¹Ù„ÙŠ</p>
                    <a href="../index.html" class="btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="container quiz-system">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <div id="loadingScreen" class="loading-container">
            <div class="loading-spinner"></div>
            <h2>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</h2>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="quizInfoScreen" style="display: none;">
            <div class="quiz-header">
                <h1 id="quizTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
                <p id="quizDescription">ÙˆØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
            </div>

            <div class="quiz-info">
                <div class="info-card">
                    <div class="number" id="questionsCount">0</div>
                    <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
                </div>
                <div class="info-card">
                    <div class="number" id="timeLimit">0</div>
                    <div>Ø§Ù„ÙˆÙ‚Øª (Ø¯Ù‚ÙŠÙ‚Ø©)</div>
                </div>
                <div class="info-card">
                    <div class="number" id="passScore">60%</div>
                    <div>Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                </div>
            </div>

            <div class="quiz-container">
                <h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
                <ul style="text-align: right; line-height: 2; margin: 20px 0;">
                    <li>Ø§Ù‚Ø±Ø£ ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</li>
                    <li>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø²Ø±Ø§Ø± "Ø§Ù„Ø³Ø§Ø¨Ù‚" Ùˆ "Ø§Ù„ØªØ§Ù„ÙŠ"</li>
                    <li>Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙˆØ± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</li>
                    <li>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</li>
                </ul>

                <div class="actions-container">
                    <button class="btn btn-primary" onclick="startQuiz()">
                        â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    <a href="lessons.html" class="btn btn-secondary">
                        â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±ÙˆØ³
                    </a>
                </div>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
        <div id="quizScreen" style="display: none;">
            <div class="quiz-header">
                <h1 id="currentQuizTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="quizProgress"></div>
                </div>
                <div class="progress-text">
                    <span id="currentQuestionNumber">Ø³Ø¤Ø§Ù„ 1</span>
                    <span id="timer">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 15:00</span>
                </div>
            </div>

            <div class="quiz-container">
                <div class="question-container">
                    <div class="question-header">
                        <span class="question-number" id="questionNumber">Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 10</span>
                        <span id="questionStatus" class="alert alert-warning">ØºÙŠØ± Ù…Ø¬Ø§Ø¨</span>
                    </div>

                    <div class="question-text" id="questionText">
                        Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...
                    </div>

                    <div class="options-container" id="optionsContainer">
                        <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ØªÙØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                        â† Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
                        Ø§Ù„ØªØ§Ù„ÙŠ â†’
                    </button>
                    <button class="btn btn-success" id="submitBtn" onclick="submitQuiz()" style="display: none;">
                        âœ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="resultsScreen" style="display: none;">
            <div class="quiz-header">
                <h1>ğŸ‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
            </div>

            <div class="quiz-container">
                <div class="results-container">
                    <div class="result-score" id="finalScore">0%</div>
                    <div class="result-message" id="resultMessage">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>

                    <div class="result-details">
                        <div class="detail-item">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</span>
                            <span id="totalQuestionsResult">0</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</span>
                            <span id="correctAnswers">0</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</span>
                            <span id="wrongAnswers">0</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</span>
                            <span id="timeTaken">0 Ø¯Ù‚ÙŠÙ‚Ø©</span>
                        </div>
                        <div class="detail-item">
                            <span>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                            <span id="performanceRating">-</span>
                        </div>
                    </div>

                    <div class="actions-container">
                        <button class="btn btn-primary" onclick="restartQuiz()">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                        <button class="btn btn-secondary" onclick="showAnswers()">
                            ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
                        </button>
                        <a href="lessons.html" class="btn btn-success">
                            ğŸ“š Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±ÙˆØ³
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Ø§Ù„ÙÙˆØªØ± -->
    <footer class="footer">
        <div class="container">
            <p>Â© 2024 Discover with Dalty - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¥ÙŠÙ‡Ø§Ø¨ Ù…Ø§Ø²ÙŠ</p>
        </div>
    </footer>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        let currentTest = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime = null;
        let timerInterval = null;
        let timeLeft = 0;

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadQuiz();
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function loadQuiz() {
            const urlParams = new URLSearchParams(window.location.search);
            const testId = urlParams.get('test') || localStorage.getItem('currentTestId');
            
            if (!testId) {
                showError('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }

            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
            loadTestFromSources(testId);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
        function loadTestFromSources(testId) {
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ù…Ù† localStorage
            const savedTests = JSON.parse(localStorage.getItem('savedTests') || '{}');
            if (savedTests[testId]) {
                initializeQuiz(savedTests[testId]);
                return;
            }

            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 2: Ù…Ù† Ù…Ù„Ù Ù…Ø­Ù„ÙŠ
            loadTestFromFile(testId);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…Ù„Ù
        function loadTestFromFile(testId) {
            fetch(`tests/${testId}.json`)
                .then(response => {
                    if (!response.ok) throw new Error('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    return response.json();
                })
                .then(testData => {
                    initializeQuiz(testData);
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                    showError('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function initializeQuiz(testData) {
            currentTest = testData;
            currentQuestions = testData.questions || [];
            userAnswers = new Array(currentQuestions.length).fill(null);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('quizInfoScreen').style.display = 'block';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            document.getElementById('quizTitle').textContent = currentTest.title;
            document.getElementById('quizDescription').textContent = currentTest.description || 'Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³';
            document.getElementById('questionsCount').textContent = currentQuestions.length;
            document.getElementById('timeLimit').textContent = currentTest.time || 15;
            document.getElementById('currentQuizTitle').textContent = currentTest.title;
            
            timeLeft = (currentTest.time || 15) * 60; // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø«ÙˆØ§Ù†ÙŠ
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function startQuiz() {
            document.getElementById('quizInfoScreen').style.display = 'none';
            document.getElementById('quizScreen').style.display = 'block';
            
            startTime = new Date();
            startTimer();
            showQuestion(0);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
        function showQuestion(index) {
            if (index < 0 || index >= currentQuestions.length) return;
            
            currentQuestionIndex = index;
            const question = currentQuestions[index];
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            document.getElementById('questionNumber').textContent = `Ø³Ø¤Ø§Ù„ ${index + 1} Ù…Ù† ${currentQuestions.length}`;
            document.getElementById('currentQuestionNumber').textContent = `Ø³Ø¤Ø§Ù„ ${index + 1}`;
            document.getElementById('questionText').textContent = question.text;
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const progress = ((index + 1) / currentQuestions.length) * 100;
            document.getElementById('quizProgress').style.width = `${progress}%`;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
            updateQuestionStatus();
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            const letters = ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'];
            question.options.forEach((option, optionIndex) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (userAnswers[index] === optionIndex) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-letter">${letters[optionIndex]}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionElement.onclick = () => selectOption(optionIndex);
                optionsContainer.appendChild(optionElement);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            updateNavigationButtons();
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        function updateNavigationButtons() {
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentQuestions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'inline-flex';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-flex';
                document.getElementById('submitBtn').style.display = 'none';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
        function updateQuestionStatus() {
            const statusElement = document.getElementById('questionStatus');
            if (userAnswers[currentQuestionIndex] !== null) {
                statusElement.textContent = 'ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©';
                statusElement.className = 'alert alert-success';
            } else {
                statusElement.textContent = 'ØºÙŠØ± Ù…Ø¬Ø§Ø¨';
                statusElement.className = 'alert alert-warning';
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø©
        function selectOption(optionIndex) {
            userAnswers[currentQuestionIndex] = optionIndex;
            updateQuestionStatus();
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }

        // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function submitQuiz() {
            clearInterval(timerInterval);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - startTime) / 1000); // Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
            const correctAnswers = userAnswers.filter((answer, index) => 
                answer === currentQuestions[index].correctAnswer
            ).length;
            
            const score = Math.round((correctAnswers / currentQuestions.length) * 100);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            showResults(score, correctAnswers, timeTaken);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResults(score, correctAnswers, timeTaken) {
            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            document.getElementById('finalScore').textContent = `${score}%`;
            document.getElementById('totalQuestionsResult').textContent = currentQuestions.length;
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('wrongAnswers').textContent = currentQuestions.length - correctAnswers;
            
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('timeTaken').textContent = 
                `${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${seconds} Ø«Ø§Ù†ÙŠØ©`;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
            let message = '';
            let rating = '';
            
            if (score >= 90) {
                message = 'Ù…Ù…ØªØ§Ø²! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹ ğŸ‰';
                rating = 'Ù…Ù…ØªØ§Ø²';
            } else if (score >= 75) {
                message = 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! Ø£Ø­Ø³Ù†Øª Ø¹Ù…Ù„ ğŸ’ª';
                rating = 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
            } else if (score >= 60) {
                message = 'Ø¬ÙŠØ¯! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³ÙŠÙ† ğŸ“ˆ';
                rating = 'Ø¬ÙŠØ¯';
            } else {
                message = 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ“š';
                rating = 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†';
            }
            
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('performanceRating').textContent = rating;
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            saveQuizResult(score, correctAnswers, timeTaken);
        }

        // Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function saveQuizResult(score, correctAnswers, timeTaken) {
            const quizResults = JSON.parse(localStorage.getItem('quizResults') || '{}');
            const resultId = `result_${Date.now()}`;
            
            quizResults[resultId] = {
                testId: currentTest.id,
                testTitle: currentTest.title,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: currentQuestions.length,
                timeTaken: timeTaken,
                date: new Date().toISOString(),
                lessonLink: currentTest.lessonLink
            };
            
            localStorage.setItem('quizResults', JSON.stringify(quizResults));
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function restartQuiz() {
            userAnswers = new Array(currentQuestions.length).fill(null);
            currentQuestionIndex = 0;
            timeLeft = (currentTest.time || 15) * 60;
            
            document.getElementById('resultsScreen').style.display = 'none';
            startQuiz();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        function showAnswers() {
            let answersHtml = '<h3>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©:</h3>';
            
            currentQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;
                const correctAnswerLetter = ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'][question.correctAnswer];
                const userAnswerLetter = userAnswer !== null ? ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'][userAnswer] : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©';
                
                answersHtml += `
                    <div class="question-review" style="margin: 20px 0; padding: 15px; background: ${isCorrect ? '#f0fff4' : '#fed7d7'}; border-radius: 8px; border-right: 4px solid ${isCorrect ? '#48bb78' : '#e53e3e'};">
                        <strong>Ø³Ø¤Ø§Ù„ ${index + 1}:</strong> ${question.text}<br>
                        <span style="color: ${isCorrect ? '#22543d' : '#742a2a'};">
                            Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${userAnswerLetter} | Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswerLetter}
                        </span>
                        ${question.explanation ? `<br><em>Ø´Ø±Ø­: ${question.explanation}</em>` : ''}
                    </div>
                `;
            });
            
            // ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£Ùˆ ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©
            alert(answersHtml);
        }

        // Ø¹Ø±Ø¶ Ø®Ø·Ø£
        function showError(message) {
            document.getElementById('loadingScreen').innerHTML = `
                <div style="text-align: center; color: #e53e3e; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">âŒ</div>
                    <h2>${message}</h2>
                    <a href="lessons.html" class="btn btn-primary" style="margin-top: 20px;">
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±ÙˆØ³
                    </a>
                </div>
            `;
        }

        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±ÙˆØ³
        window.startQuizFromLesson = function(testId) {
            localStorage.setItem('currentTestId', testId);
            window.location.href = `quiz.html?test=${testId}`;
        };
        // Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
async function loadTestFromSources(testId) {
    console.log('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', testId);
    
    // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ù…Ù† localStorage
    const savedTests = JSON.parse(localStorage.getItem('savedTests') || '{}');
    if (savedTests[testId]) {
        console.log('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ localStorage');
        initializeQuiz(savedTests[testId]);
        return;
    }

    // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 2: Ù…Ù† Ù…Ù„Ù Ù…Ø­Ù„ÙŠ ÙÙŠ Ù…Ø¬Ù„Ø¯ tests
    try {
        const response = await fetch(`tests/${testId}.json`);
        if (response.ok) {
            const testData = await response.json();
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ù…Ø¬Ù„Ø¯ tests');
            
            // Ø­ÙØ¸ Ù†Ø³Ø®Ø© ÙÙŠ localStorage Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
            savedTests[testId] = testData;
            localStorage.setItem('savedTests', JSON.stringify(savedTests));
            
            initializeQuiz(testData);
            return;
        }
    } catch (error) {
        console.log('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…Ø¬Ù„Ø¯ tests');
    }

    // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 3: Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
    try {
        const cloudTest = await loadTestFromCloud(testId);
        if (cloudTest) {
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
            savedTests[testId] = cloudTest;
            localStorage.setItem('savedTests', JSON.stringify(savedTests));
            initializeQuiz(cloudTest);
            return;
        }
    } catch (error) {
        console.log('Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
    }

    // Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
    showError('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…Ø¬Ù„Ø¯ tests.');
}
    </script>
    
</body>
</html>