<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>اختبار JSON</title>
<style>
  body { font-family: sans-serif; direction: rtl; padding: 20px; }
  .question { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
  button { display: block; margin: 5px 0; padding: 10px; width: 100%; cursor: pointer; }
  .correct { color: green; font-weight: bold; }
  .wrong { color: red; font-weight: bold; }
  #retryBtn{ margin-top:20px; padding:10px; width:100%; font-weight:bold; }
</style>
</head>
<body>

<h2 id="exam-title"></h2>
<div id="exam-content"></div>

<h3 id="final-score"></h3>
<button id="retryBtn" onclick="startExam()" style="display:none;">إعادة الاختبار</button>

<script>
let originalQuestions = [];
let questions = [];
let score = 0;
let answered = 0;

fetch("data.json")
  .then(res => res.json())
  .then(data => {
    originalQuestions = data.questions;
    document.getElementById("exam-title").textContent = data.title;
    startExam();
  });

// خلط الأسئلة عشوائيا
function shuffle(array){
  return array.sort(() => Math.random() - 0.5);
}

function startExam(){
  score = 0;
  answered = 0;
  document.getElementById("final-score").textContent = "";
  document.getElementById("retryBtn").style.display = "none";

  questions = shuffle([...originalQuestions]);

  let html = "";
  questions.forEach((qObj, index) => {
    html += `<div class="question">
      <p><b>س${index+1}:</b> ${qObj.q}</p>
    `;
    qObj.choices.forEach((choice, cIndex) => {
      html += `<button onclick="checkAnswer(${index}, ${cIndex})">${choice}</button>`;
    });
    html += `<p id="result_${index}"></p></div>`;
  });

  document.getElementById("exam-content").innerHTML = html;
}

function checkAnswer(qIndex, cIndex){
  const resultP = document.getElementById("result_" + qIndex);
  if(resultP.innerHTML !== "") return;

  if (questions[qIndex].correct === cIndex) {
    resultP.innerHTML = "<span class='correct'>إجابة صحيحة ✔</span>";
    score++;
  } else {
    resultP.innerHTML = "<span class='wrong'>إجابة خاطئة ✘</span>";
  }

  answered++;

  if(answered === questions.length){
    document.getElementById("final-score").textContent =
      "درجتك: " + score + " من " + questions.length;
    document.getElementById("retryBtn").style.display = "block";
  }
}
</script>

</body>
</html>
